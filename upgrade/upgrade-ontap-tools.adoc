---
permalink: upgrade/upgrade-ontap-tools.html 
sidebar: sidebar 
keywords: upgrade 
summary: HA 및 비 HA 배포 모두에 대한 업그레이드가 지원됩니다. 
---
= ONTAP tools for VMware vSphere 에서 10.4로 업그레이드
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
ONTAP tools for VMware vSphere 에서 10.4로 업그레이드할 수 있습니다.  하지만 ONTAP 도구 10.0 또는 10.1에서 10.4로 직접 업그레이드하는 것은 지원되지 않습니다.

메모:

* ASA r2 시스템에서는 더 많은 스토리지 가용성 영역(SAZ)을 추가하기 전에 ONTAP 9.16.1을 사용하여 ONTAP tools for VMware vSphere 로 업그레이드해야 합니다.
* ONTAP tools for VMware vSphere 에서 10.4 릴리스로의 업그레이드가 실패하면 롤백이 지원되지 않습니다.  설정을 복구하려면 ONTAP tools for VMware vSphere 에 RPO를 사용하고 ONTAP tools for VMware vSphere 에 거의 0에 가까운 RPO 또는 스냅샷 복구를 사용합니다.


.시작하기 전에
HA가 아닌 업그레이드의 경우 ONTAP 도구 VM의 전원을 끄고, HA 업그레이드의 경우 가상 머신(VM) 설정에 다음과 같은 변경을 하기 전에 ONTAP 도구 관리 노드의 전원을 끕니다.

ONTAP tools for VMware vSphere 에서 업그레이드하는 경우, 업그레이드 작업을 진행하기 전에 다음 단계를 완료해야 합니다. * 서비스 데이터는 VM에 로컬로 저장되므로 각 노드에 100GB 하드 디스크를 추가합니다. * 배포 버전에 따라 전원이 꺼진 VM의 CPU와 메모리를 변경합니다. CPU 및 RAM 핫 플러그인을 활성화합니다.

+

|===
| 배포 유형 | 노드당 CPU(코어) | 노드당 메모리(GB) | 노드당 디스크 공간(GB) | 총 CPU(코어) | 메모리(GB) | 총 디스크 공간(GB) 


| 비HA 소형 | 9 | 18 | 350 | 9 | 18 | 350 


| 비HA 매체 | 13 | 26 | 350 | 13 | 26 | 350 


| HA 스몰 | 9 | 18 | 350 | 27 | 54 | 1050 


| HA 중간 | 13 | 26 | 350 | 39 | 78 | 1050 


| HA 대형 | 17 | 34 | 350 | 51 | 102 | 1050 
|===
* 변경이 완료되면 VM의 전원을 켜고 서비스가 실행 상태가 될 때까지 기다립니다.
* HA 배포의 경우 리소스를 변경하고 CPU와 RAM에 대한 핫 플러그인을 활성화하고 두 번째와 세 번째 노드에도 100GB 하드 디스크를 추가합니다.  이 노드를 재부팅할 필요는 없습니다.
* ONTAP 도구 10.2를 사용하여 어플라이언스를 로컬 경로(간편 배포)로 배포한 경우 업그레이드하기 전에 정지 스냅샷을 찍어야 합니다.


ONTAP tools for VMware vSphere 에서 10.1로 업그레이드하는 경우 업그레이드 작업을 진행하기 전에 다음 단계를 완료해야 합니다. *진단 활성화*

. vCenter Server에서 ONTAP 도구로 콘솔을 엽니다.
. 유지 관리 사용자로 로그인합니다.
. *지원 및 진단*을 선택하려면 *4*를 입력하세요.
. *원격 진단 액세스 활성화*를 선택하려면 *2*를 입력하세요.
. 원하는 비밀번호를 설정하려면 *y*를 입력하세요.
. 터미널/퍼티에서 사용자 이름을 'diag'로 하고 이전 단계에서 설정한 비밀번호를 사용하여 VM IP 주소에 로그인합니다.


*MongoDB 백업하기*

다음 명령을 실행하여 MongoDB 백업을 수행합니다.

* kn exec -it ntv-mongodb-0 sh - kn은 kubectl -n ntv-system의 별칭입니다.
* Pod 내부에서 _env | grep MONGODB_ROOT_PASSWORD_ 명령을 실행합니다.
* 포드에서 나오려면 _exit_ 명령을 실행하세요.
* 위 명령에서 설정한 MONGO_ROOT_PASSWORD를 바꾸려면 _kn exec ntv-mongodb-0 --mongodump -u root -p MONGODB_ROOT_PASSWORD --archive=/tmp/mongodb-backup.gz --gzip_ 명령을 실행합니다.
* 위 명령을 사용하여 생성된 mongodb 백업을 포드에서 호스트로 복사하려면 _kn cp ntv-mongodb-0:/tmp/mongodb-backup.gz ./mongodb-backup.gz_ 명령을 실행합니다.


*모든 볼륨의 퀘이즈 스냅샷을 찍으세요*

* 'kn get pvc' 명령을 실행하고 명령 출력을 저장합니다.
* 다음 방법 중 하나를 사용하여 모든 볼륨의 스냅샷을 하나씩 찍습니다.
+
** CLI에서 _volume snapshot create -vserver <vserver_name> -volume <volume_name> -snapshot <snapshot_name>_ 명령을 실행합니다.
** ONTAP 시스템 관리자 사용자 인터페이스에서 검색 창에 볼륨 이름을 입력하여 검색한 다음, 이름을 선택하여 해당 볼륨을 엽니다.  스냅샷으로 가서 해당 볼륨의 스냅샷을 추가합니다.




*vCenter에서 ONTAP tools for VMware vSphere 의 스냅샷을 만듭니다(HA 배포의 경우 3개 VM, 비 HA 배포의 경우 1개 VM)*

* vSphere 클라이언트 사용자 인터페이스에서 VM을 선택합니다.
* 스냅샷 탭으로 가서 *스냅샷 찍기* 버튼을 선택하세요.  VM의 정지된 스냅샷을 찍습니다.  참조하다 https://techdocs.broadcom.com/us/en/vmware-cis/vsphere/vsphere/8-0/take-snapshots-of-a-virtual-machine.html["가상 머신의 스냅샷을 찍습니다"^] 자세한 내용은.


업그레이드를 수행하기 전에 "generate-support-bundle-job" 접두사가 붙은 로그 번들에서 완료된 포드를 삭제합니다.  지원 번들 생성이 진행 중이면 완료될 때까지 기다린 후 Pod를 삭제하세요.

모든 유형의 업그레이드에는 100GB 하드 디스크 드라이브(HDD)를 추가해야 합니다.  HDD를 추가하려면 다음 작업을 수행하세요.

. 단일 노드 구성에서 VM을 선택하거나 HA 구성에서 세 개의 VM을 모두 선택합니다.
. VM을 마우스 오른쪽 버튼으로 클릭하고 *새 장치 추가* > *하드 디스크*를 선택합니다.
. *새 하드 디스크* 필드에 100GB HDD를 추가합니다.
. *적용*을 선택하세요


하드 디스크를 추가한 후 해당 구성에 맞게 VM 리소스를 업데이트하고 기본 VM을 다시 시작합니다.

새로운 HDD가 생성됩니다.  동적 스토리지 프로비저너는 이 HDD를 사용하여 볼륨을 생성하거나 복제합니다.

.단계
. ONTAP tools for VMware vSphere 콘텐츠 라이브러리에 업로드합니다.
. 기본 VM 페이지에서 *작업* > *설정 편집*을 선택합니다.
. *CD/DVD 드라이브* 필드 아래의 편집 설정 창에서 콘텐츠 라이브러리 ISO 파일을 선택합니다.
. ISO 파일을 선택하고 *확인*을 선택합니다.  *CD/DVD 드라이브* 필드에서 연결됨 확인란을 선택합니다.image:../media/primaryvm-edit-settings.png["설정 편집"]
. vCenter Server에서 ONTAP 도구로 콘솔을 엽니다.
. 유지 관리 사용자로 로그인합니다.
. *3*을 입력하여 시스템 구성 메뉴를 선택합니다.
. 업그레이드 옵션을 선택하려면 *7*을 입력하세요.
. 업그레이드하면 다음 작업이 자동으로 수행됩니다.
+
.. 인증서 업그레이드
.. 원격 플러그인 업그레이드




ONTAP tools for VMware vSphere 로 업그레이드한 후 다음을 수행할 수 있습니다.

* 관리자 사용자 인터페이스에서 서비스 비활성화
* 비 HA 설정에서 HA 설정으로 이동
* HA가 아닌 소규모 구성을 HA가 아닌 중규모 구성으로 확장하거나 HA 중규모 또는 대규모 구성으로 확장합니다.
* HA가 아닌 업그레이드의 경우 ONTAP 도구 VM을 재부팅하여 변경 사항을 반영합니다. HA 업그레이드의 경우 ONTAP 도구 관리 노드를 재부팅하여 노드의 변경 사항을 반영합니다.


.다음은 무엇입니까?
ONTAP tools for VMware vSphere 의 이전 릴리스에서 10.4로 업그레이드한 후 SRA 어댑터를 다시 검사하여 VMware Live Site Recovery Storage Replication 어댑터 페이지에서 세부 정보가 업데이트되었는지 확인하세요.

업그레이드가 성공적으로 완료되면 다음 절차에 따라 ONTAP 에서 Trident 볼륨을 수동으로 삭제합니다.


NOTE: ONTAP tools for VMware vSphere HA가 아닌 소규모 또는 중규모(로컬 경로) 구성인 경우 이러한 단계는 필요하지 않습니다.

. vCenter Server에서 ONTAP 도구로 콘솔을 엽니다.
. 유지 관리 사용자로 로그인합니다.
. *지원 및 진단* 메뉴를 선택하려면 *4*를 입력하세요.
. *진단 셸 액세스* 옵션을 선택하려면 *1*을 입력합니다.
. 다음 명령을 실행하세요
+
[listing]
----
sudo python3 /home/maint/scripts/ontap_cleanup.py
----
. ONTAP 사용자 이름과 비밀번호를 입력하세요


이렇게 하면 ONTAP tools for VMware vSphere 에서 사용되는 ONTAP 의 모든 Trident 볼륨이 삭제됩니다.

.관련 정보
link:../migrate/migrate-to-latest-ontaptools.html["ONTAP tools for VMware vSphere 에서 10.4로 마이그레이션"]
